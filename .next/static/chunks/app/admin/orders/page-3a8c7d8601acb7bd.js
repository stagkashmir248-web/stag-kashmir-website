(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[798],{24:(e,t,s)=>{"use strict";s.d(t,{default:()=>p});var a=s(5155),l=s(2115),r=s(3925),n=s(6874),o=s.n(n),d=s(9589),c=s(2296),i=s(8794);let x={PENDING:{label:"Pending",cls:"bg-slate-700 text-slate-300"},PROCESSING:{label:"Processing",cls:"bg-blue-500/20 text-blue-300"},PAID_PARTIAL:{label:"Booking Paid",cls:"bg-amber-500/20 text-amber-300"},PAID:{label:"Paid",cls:"bg-green-500/20 text-green-300"},DISPATCHED:{label:"Dispatched",cls:"bg-purple-500/20 text-purple-300"},SHIPPED:{label:"Shipped",cls:"bg-indigo-500/20 text-indigo-300"},DELIVERED:{label:"Delivered",cls:"bg-green-500/20 text-green-400"},CANCELLED:{label:"Cancelled",cls:"bg-red-500/20 text-red-400"}};function p(e){let{orders:t}=e,[s,n]=(0,l.useState)(""),p=(0,c.GP)(new Date,"yyyy-MM-dd"),[m,u]=(0,l.useState)(p),[h,b]=(0,l.useState)(p),g=s.toLowerCase().trim(),f=g?t.filter(e=>{var t;return e.customer.toLowerCase().includes(g)||e.email.toLowerCase().includes(g)||(null!==(t=e.phone)&&void 0!==t?t:"").toLowerCase().includes(g)||e.id.slice(-8).toUpperCase().includes(s.toUpperCase())||String(e.total).includes(g)||null!=e.amountPaid&&String(e.amountPaid).includes(g)}):t,N={};f.forEach(e=>{let t=e.createdAt.slice(0,10);N[t]||(N[t]=[]),N[t].push(e)});let j=Object.keys(N).sort((e,t)=>t.localeCompare(e));return(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-end justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-white",children:"Order Inquiries"}),(0,a.jsxs)("p",{className:"text-slate-400 mt-1",children:[f.length," of ",t.length," orders"]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-end gap-3 bg-slate-800 border border-slate-700 rounded-xl px-5 py-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"From"}),(0,a.jsx)("input",{type:"date",value:m,onChange:e=>u(e.target.value),className:"bg-slate-700 text-white text-sm rounded-lg px-3 py-2 border border-slate-600 focus:outline-none focus:border-primary"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"To"}),(0,a.jsx)("input",{type:"date",value:h,onChange:e=>b(e.target.value),className:"bg-slate-700 text-white text-sm rounded-lg px-3 py-2 border border-slate-600 focus:outline-none focus:border-primary"})]}),(0,a.jsxs)("button",{onClick:function(){let e=new Date(m),s=new Date(h);s.setHours(23,59,59,999);let a=t.filter(t=>{let a=new Date(t.createdAt);return a>=e&&a<=s});if(0===a.length){alert("No orders found in the selected date range.");return}let l=a.map(e=>{var t,s,a,l,r;return{"Order ID":"#".concat(e.id.slice(-8).toUpperCase()),Date:(0,c.GP)(new Date(e.createdAt),"dd MMM yyyy HH:mm"),Customer:e.customer,Email:e.email,Phone:null!==(s=e.phone)&&void 0!==s?s:"",Address:[e.address,e.city,e.state,e.pincode].filter(Boolean).join(", "),Items:e.items.map(e=>{var t,s;return"".concat(null!==(s=null===(t=e.product)||void 0===t?void 0:t.name)&&void 0!==s?s:"?"," \xd7").concat(e.quantity)}).join("; "),"Order Total (₹)":e.total,"Amount Paid (₹)":null!==(a=e.amountPaid)&&void 0!==a?a:"PAID"===e.status?e.total:0,"Balance Due (₹)":"PAID"===e.status?0:Math.max(0,e.total-(null!==(l=e.amountPaid)&&void 0!==l?l:0)),"Payment Type":e.paymentType,Status:null!==(r=null===(t=x[e.status])||void 0===t?void 0:t.label)&&void 0!==r?r:e.status}}),n=r.Wp.json_to_sheet(l),o=r.Wp.book_new();r.Wp.book_append_sheet(o,n,"Orders"),r._h(o,"StagKashmir_Orders_".concat(m,"_to_").concat(h,".xlsx"))},className:"flex items-center gap-2 bg-primary hover:bg-amber-400 text-black font-bold text-sm py-2.5 px-5 rounded-lg transition-all",children:[(0,a.jsx)("span",{className:"material-symbols-outlined !text-[18px]",children:"download"}),"Export Excel"]})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 !text-[20px]",children:"search"}),(0,a.jsx)("input",{type:"text",value:s,onChange:e=>n(e.target.value),placeholder:"Search by name, phone, email, order ID or amount…",className:"w-full pl-12 pr-12 py-3.5 bg-slate-800 border border-slate-700 focus:border-primary text-white rounded-xl text-sm outline-none placeholder-slate-500 transition-colors"}),s&&(0,a.jsx)("button",{onClick:()=>n(""),className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-white transition-colors",children:(0,a.jsx)("span",{className:"material-symbols-outlined !text-[20px]",children:"close"})})]})]}),0===j.length?(0,a.jsxs)("div",{className:"bg-slate-900 rounded-xl border border-slate-800 py-16 text-center text-slate-500",children:[(0,a.jsx)("span",{className:"material-symbols-outlined !text-5xl text-slate-700 block mb-3",children:s?"search_off":"receipt_long"}),s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"text-white font-semibold mb-1",children:['No orders found for "',s,'"']}),(0,a.jsx)("p",{className:"text-sm",children:"Try searching by a different name, phone, or order ID"}),(0,a.jsx)("button",{onClick:()=>n(""),className:"mt-4 text-primary hover:underline text-sm font-bold",children:"Clear search"})]}):(0,a.jsx)("p",{children:"No orders yet."})]}):j.map(e=>{let t=N[e],s=t.reduce((e,t)=>e+t.total,0),l=t.reduce((e,t)=>{var s;return e+(null!==(s=t.amountPaid)&&void 0!==s?s:"PAID"===t.status?t.total:0)},0),r=s-l,n=(0,c.GP)((0,i.H)(e),"EEEE, dd MMMM yyyy");return(0,a.jsxs)("div",{className:"flex flex-col gap-0 rounded-xl border border-slate-700 overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4 px-6 py-3 bg-slate-800 border-b border-slate-700",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"material-symbols-outlined !text-[18px] text-primary",children:"calendar_today"}),(0,a.jsx)("span",{className:"font-bold text-white",children:n}),(0,a.jsxs)("span",{className:"text-xs bg-slate-700 text-slate-300 px-2.5 py-1 rounded-full font-bold",children:[t.length," order",1!==t.length?"s":""]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-6 text-sm",children:[(0,a.jsxs)("span",{className:"text-slate-400",children:["Total: ",(0,a.jsxs)("strong",{className:"text-white",children:["₹",s.toLocaleString("en-IN")]})]}),(0,a.jsxs)("span",{className:"text-slate-400",children:["Collected: ",(0,a.jsxs)("strong",{className:"text-green-300",children:["₹",l.toLocaleString("en-IN")]})]}),r>0&&(0,a.jsxs)("span",{className:"text-slate-400",children:["Balance: ",(0,a.jsxs)("strong",{className:"text-amber-300",children:["₹",r.toLocaleString("en-IN")]})]})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto bg-slate-900",children:(0,a.jsxs)("table",{className:"w-full text-left border-collapse",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-slate-800 bg-slate-900/50",children:[(0,a.jsx)("th",{className:"py-3 px-6 font-bold text-[11px] uppercase tracking-wider text-slate-500",children:"Order ID"}),(0,a.jsx)("th",{className:"py-3 px-6 font-bold text-[11px] uppercase tracking-wider text-slate-500",children:"Customer"}),(0,a.jsx)("th",{className:"py-3 px-6 font-bold text-[11px] uppercase tracking-wider text-slate-500",children:"Items"}),(0,a.jsx)("th",{className:"py-3 px-6 font-bold text-[11px] uppercase tracking-wider text-slate-500 text-right",children:"Order Total"}),(0,a.jsx)("th",{className:"py-3 px-6 font-bold text-[11px] uppercase tracking-wider text-slate-500 text-right",children:"Paid"}),(0,a.jsx)("th",{className:"py-3 px-6 font-bold text-[11px] uppercase tracking-wider text-slate-500 text-right",children:"Balance Due"}),(0,a.jsx)("th",{className:"py-3 px-6 font-bold text-[11px] uppercase tracking-wider text-slate-500 text-center",children:"Status"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-slate-800",children:t.map(e=>{var t;let s=null!==(t=e.amountPaid)&&void 0!==t?t:"PAID"===e.status?e.total:0,l=Math.max(0,e.total-s),r=(0,c.GP)(new Date(e.createdAt),"hh:mm a");return(0,a.jsxs)("tr",{className:"hover:bg-slate-800/50 transition-colors",children:[(0,a.jsxs)("td",{className:"py-4 px-6",children:[(0,a.jsxs)(o(),{href:"/admin/orders/".concat(e.id),className:"font-mono text-sm font-bold text-primary hover:underline block",children:["#",e.id.slice(-8).toUpperCase()]}),(0,a.jsx)("span",{className:"text-xs text-slate-500",children:r})]}),(0,a.jsxs)("td",{className:"py-4 px-6",children:[(0,a.jsx)("p",{className:"text-white text-sm font-semibold",children:e.customer}),(0,a.jsx)("p",{className:"text-xs text-slate-400",children:e.email}),e.phone&&(0,a.jsx)("p",{className:"text-xs text-slate-400",children:e.phone})]}),(0,a.jsx)("td",{className:"py-4 px-6",children:(0,a.jsx)("div",{className:"flex flex-col gap-1.5",children:e.items.map(e=>{var t,s,l;return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(null===(t=e.product)||void 0===t?void 0:t.imageUrl)&&(0,a.jsx)("img",{src:e.product.imageUrl,alt:"",className:"size-7 rounded object-cover border border-slate-700"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-medium text-white line-clamp-1",children:null!==(l=null===(s=e.product)||void 0===s?void 0:s.name)&&void 0!==l?l:"?"}),(0,a.jsxs)("p",{className:"text-[11px] text-slate-500",children:["Qty: ",e.quantity," \xd7 ₹",e.price.toLocaleString("en-IN")]})]})]},e.id)})})}),(0,a.jsx)("td",{className:"py-4 px-6 text-right",children:(0,a.jsxs)("span",{className:"font-bold text-white",children:["₹",e.total.toLocaleString("en-IN")]})}),(0,a.jsxs)("td",{className:"py-4 px-6 text-right",children:[(0,a.jsxs)("span",{className:"font-semibold ".concat(s>0?"text-green-300":"text-slate-500"),children:["₹",s.toLocaleString("en-IN")]}),"PARTIAL"===e.paymentType&&(0,a.jsx)("p",{className:"text-[10px] text-amber-400 mt-0.5",children:"Booking"})]}),(0,a.jsx)("td",{className:"py-4 px-6 text-right",children:l>0?(0,a.jsxs)("span",{className:"font-bold text-amber-300",children:["₹",l.toLocaleString("en-IN")]}):(0,a.jsx)("span",{className:"text-green-400 font-bold text-xs",children:"CLEARED"})}),(0,a.jsx)("td",{className:"py-4 px-6 text-center",children:(0,a.jsx)(d.default,{orderId:e.id,currentStatus:e.status})})]},e.id)})})]})})]},e)})]})}},2383:()=>{},3686:()=>{},4790:(e,t,s)=>{Promise.resolve().then(s.bind(s,24))},9589:(e,t,s)=>{"use strict";s.d(t,{default:()=>c});var a=s(5155),l=s(4477);let r=(0,l.createServerReference)("60f97187c73d9ebce955552a292be5de744788f71a",l.callServer,void 0,l.findSourceMapURL,"updateOrderStatus");var n=s(2115),o=s(3568);let d=["PENDING","PROCESSING","SHIPPED","DELIVERED","CANCELLED"];function c(e){let{orderId:t,currentStatus:s}=e,[l,c]=(0,n.useTransition)(),[i,x]=(0,n.useState)(s);return(0,a.jsx)("select",{value:i,onChange:e=>{let a=e.target.value;x(a),c(async()=>{let e=await r(t,a);e.success?o.Ay.success("Order marked as ".concat(a)):(o.Ay.error(e.error||"Failed to update order"),x(s))})},disabled:l,className:"text-xs font-bold uppercase tracking-wider rounded-full px-3 py-1.5 border appearance-none cursor-pointer text-center outline-none focus:ring-2 focus:ring-offset-1 transition-all ".concat((e=>{switch(e){case"PENDING":return"bg-amber-100 text-amber-800 border-amber-200 focus:ring-amber-500";case"PROCESSING":return"bg-blue-100 text-blue-800 border-blue-200 focus:ring-blue-500";case"SHIPPED":return"bg-indigo-100 text-indigo-800 border-indigo-200 focus:ring-indigo-500";case"DELIVERED":return"bg-green-100 text-green-800 border-green-200 focus:ring-green-500";case"CANCELLED":return"bg-red-100 text-red-800 border-red-200 focus:ring-red-500";default:return"bg-slate-100 text-slate-800 border-slate-200 focus:ring-slate-500"}})(i)," ").concat(l?"opacity-50 cursor-not-allowed":""),children:d.map(e=>(0,a.jsx)("option",{value:e,className:"bg-white text-slate-900 font-medium",children:e},e))})}}},e=>{var t=t=>e(e.s=t);e.O(0,[524,874,84,755,441,684,358],()=>t(4790)),_N_E=e.O()}]);